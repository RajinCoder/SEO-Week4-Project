{% extends "layout.html" %} {% block content %}
<div class="pet-body">
  <div class="header">
    <a
      style="text-decoration: none; color: #f7a80f"
      href="{{ request.url_root }}"
    >
      <h1>FUREVER HOME</h1>
    </a>
    <img
      src="{{ url_for('static', filename='pawprint.png') }}"
      alt="Pawprint"
      class="img-title"
    />
    <div class="nav-links">
      <a href="{{ url_for('favorites_page') }}">MY FAVORITES</a>
      <a href="{{ url_for('logout') }}">LOG OUT</a>
    </div>
  </div>
  <div style="display: flex; padding: 0 20px 0 10px; gap: 20px">
    <div class="image-sidebar left">
      <img
        src="{{ url_for('static', filename='bone.png') }}"
        alt="Bone"
        class="img-title"
      />
      <img
        src="{{ url_for('static', filename='fish.png') }}"
        alt="Fish"
        class="img-title"
      />
      <img
        src="{{ url_for('static', filename='carrot.png') }}"
        alt="Carrot"
        class="img-title"
      />
      <img
        src="{{ url_for('static', filename='worm.png') }}"
        alt="Worm"
        class="img-title"
      />
    </div>
    <div class="post-details box">
      <div class="post-details-head">
        {% if post.images and post.images[0] %}
        <img src="{{ post.images[0].original_url }}" alt="Pet Image" />
        {% else %} {% set default_pic = '' %} {% if post.species == 'Dog'%} {%
        set default_pic = url_for('static', filename='default_dog.webp') %}
        <img
          id="special-dog-case"
          src="{{ url_for('static', filename='default_dog.webp') }}"
          alt="Default Image"
        />
        {% elif post.species == 'Cat'%} {% set default_pic = url_for('static',
        filename='default_cat.png') %}
        <img
          src="{{ url_for('static', filename='default_cat.png') }}"
          alt="Default Image"
        />
        {% elif post.species == 'Rabbit'%} {% set default_pic =
        url_for('static', filename='default_rabbit.png') %}
        <img
          src="{{ url_for('static', filename='default_rabbit.png') }}"
          alt="Default Image"
        />
        {% elif post.species == 'Bird'%} {% set default_pic = url_for('static',
        filename='default_bird.png') %}
        <img
          src="{{ url_for('static', filename='default_bird.png') }}"
          alt="Default Image"
        />
        {% else %} {% set default_pic = url_for('static',
        filename='default_image.png') %}
        <img
          src="{{ url_for('static', filename='default_image.png') }}"
          alt="Default Image"
        />
        {% endif %} {% endif %} {% if is_favorited %}
        <img
          src="{{ url_for('static', filename='unfav-icon.png') }}"
          alt="Unfavorite"
          class="favorite-icon"
          data-pet-id="{{ post.pet_id }}"
          onclick="removeFromFavorites(this)"
          style="
            width: 100px;
            height: 100px;
            padding: 10px;
            cursor: pointer;
            position: absolute;
            top: 160px;
            right: 200px;
          "
        />
        {% else %}
        <img
          src="{{ url_for('static', filename='fav-icon.png') }}"
          alt="Favorite"
          class="favorite-icon"
          data-pet-id="{{ post.pet_id }}"
          data-name="{{ post.pet_name }}"
          data-primary-breed="{{ post.primary_breed }}"
          data-secondary-breed="{{ post.secondary_breed }}"
          data-sex="{{ post.sex }}"
          data-age="{{ post.age }}"
          data-photo-link="{{ post.images[0].original_url if post.images and post.images[0] else default_pic}}"
          data-large-photo-link="{{ post.large_photo_link }}"
          onclick="addToFavorites(this)"
          style="
            width: 100px;
            height: 100px;
            padding: 10px;
            cursor: pointer;
            position: absolute;
            top: 160px;
            right: 200px;
          "
        />
        {% endif %}
        <div style="display: flex; align-items: center; width: 30%">
          {% if post.status == 'available' %}
          <a
            href="{{ post.pet_details_url }}"
            target="_blank"
            class="avail-button"
            >Available</a
          >
          {% else %}
          <a
            href="{{ post.pet_details_url }}"
            target="_blank"
            class="avail-button"
            >Not Available</a
          >
          {% endif %} {% if post.act_quickly == 1 %}
          <img
            src="{{ url_for('static', filename='warning.png') }}"
            alt="Warning"
          />
          {% endif %}
        </div>
      </div>
      <div class="post-details-body">
        <div style="display: flex; flex-direction: column">
          <p>Name: {{ post.pet_name }}</p>
          <p>Size: {{ post.size }}</p>
          <p>Sex: {{ post.sex }}</p>
          <p>Age: {{ post.age }}</p>
        </div>
        <div style="display: flex; flex-direction: column">
          <p>Location: {{ post.addr_city }}, {{ post.addr_state_code }}</p>
          <p>Primary Breed: {{ post.primary_breed }}</p>
          <p>Secondary Breed: {{ post.secondary_breed }}</p>
          {% if post.special_needs == 1 %}
          <p>Has Special Needs</p>
          {% else %}
          <p>Does not have Special Needs</p>
          {% endif %}
        </div>
      </div>
    </div>
    <div class="image-sidebar right">
      <img
        src="{{ url_for('static', filename='bone.png') }}"
        alt="Bone"
        class="img-title"
      />
      <img
        src="{{ url_for('static', filename='fish.png') }}"
        alt="Fish"
        class="img-title"
      />
      <img
        src="{{ url_for('static', filename='carrot.png') }}"
        alt="Carrot"
        class="img-title"
      />
      <img
        src="{{ url_for('static', filename='worm.png') }}"
        alt="Worm"
        class="img-title"
      />
    </div>
    <script>
      function addToFavorites(element) {
        const fav_petId = element.getAttribute("data-pet-id");
        console.log("Pet ID:", fav_petId);

        const pname = element.getAttribute("data-name");
        const ppbreed = element.getAttribute("data-primary-breed");
        const psbreed = element.getAttribute("data-second-breed");
        const psex = element.getAttribute("data-sex");
        const page = element.getAttribute("data-age");
        const pphoto = element.getAttribute("data-photo-link");
        const plphoto = element.getAttribute("data-large-photo-link");

        const petDetails = {
          pet_id: fav_petId,
          name: pname,
          primary_breed: ppbreed,
          secondary_breed: psbreed,
          sex: psex,
          age: page,
          photo: pphoto,
          large_photo: plphoto,
        };
        console.log(JSON.stringify({
          pet_id: fav_petId,
          pet_details: petDetails,
        }))
        fetch(`/favorite/${fav_petId}`, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            pet_id: fav_petId,
            pet_details: petDetails,
          }),
          // JSON.stringify({ pet_id: fav_petId })

        })
          .then((response) => response.json())
          .then((data) => {
            if (data.status === "success") {
              alert("Pet added to favorites!");
              location.reload();
            } else {
              alert("Failed to add pet to favorites.");
            }
          })
          .catch((error) => {
            console.error("Error:", error);
            alert("An error occurred. Please try again.");
          });
      }
      function removeFromFavorites(element) {
        const faved_petID = element.getAttribute("data-pet-id");

        fetch(`/favorite/${faved_petID}`, {
          method: "DELETE",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ pet_id: faved_petID }),
        })
          .then((response) => response.json())
          .then((data) => {
            if (data.status === "success") {
              alert("Pet removed from favorites");
              location.reload();
            } else {
              alert("Failed to remove favorite.");
            }
          })
          .catch((error) => {
            console.error("Error:", error);
            alert("Error removing favorite.");
          });
      }
    </script>
  </div>
</div>
{% endblock content %}
